<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Task Tracker</title>
  <style>
    :root{
      --bg1:#74ebd5; --bg2:#9face6;
      --card:#fff; --text:#2c3e50;
      --ok:#2ecc71; --warn:#e67e22; --bad:#e74c3c; --muted:#666;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; font-family:Segoe UI,system-ui,-apple-system,sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:var(--text); display:flex; flex-direction:column; align-items:center; padding:28px;
    }
    h1{display:flex; align-items:center; gap:.6rem; margin:0 0 14px}
    h1:before{content:"âœ…"; font-size:1.4rem}
    .task-input{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-bottom:22px;
    }
    .task-input input[type="text"]{
      width:260px; padding:10px 12px; border-radius:10px; border:0; outline:none;
      box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    .task-input label{display:flex; align-items:center; gap:6px; background:rgba(255,255,255,.35);
      padding:8px 10px; border-radius:10px; backdrop-filter:blur(4px)}
    .task-input input[type="time"]{border:0; background:transparent; outline:none; padding:4px}
    .task-input button{
      padding:10px 16px; border:0; border-radius:10px; background:var(--ok); color:#fff; cursor:pointer;
      box-shadow:0 2px 8px rgba(0,0,0,.12); transition:.2s transform;
    }
    .task-input button:active{transform:scale(.98)}

    ul{list-style:none; padding:0; width:min(560px,92vw); margin:0}
    li{
      background:var(--card); border-radius:12px; padding:14px 14px 12px; margin:10px 0;
      box-shadow:0 6px 18px rgba(0,0,0,.1);
    }
    .task-main{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .task-title{font-weight:600}
    .task-actions{display:flex; align-items:center; gap:10px}
    .delete-btn{
      background:var(--bad); border:0; color:#fff; padding:6px 8px; border-radius:8px; cursor:pointer
    }
    input[type="checkbox"]{transform:scale(1.15)}

    li.completed .task-title{text-decoration:line-through; color:#999}
    .time-info{font-size:12.5px; color:var(--muted); margin-top:6px}
    .timer{font-weight:700; margin-top:3px}
    .timer.starting{color:#2980b9}
    .timer.running{color:var(--warn)}
    .timer.expired{color:var(--bad)}

    .progress-circle{
      margin:26px auto 0; width:140px; height:140px; border-radius:50%;
      background:conic-gradient(var(--ok) 0deg,#ddd 0deg);
      display:flex; align-items:center; justify-content:center; font-weight:800; color:#333;
    }
  </style>
</head>
<body>
  <h1>My Task Tracker</h1>

  <div class="task-input">
    <input id="taskInput" type="text" placeholder="Task name..." />
    <label>Start: <input id="startTime" type="time" /></label>
    <label>End: <input id="endTime" type="time" /></label>
    <button onclick="addTask()">Add</button>
  </div>

  <ul id="taskList"></ul>
  <div id="progressCircle" class="progress-circle">0%</div>

 <script>
  // Load tasks from localStorage or start fresh
  let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

  function nextOccurrence(timeStr, base = new Date()) {
    const [h, m] = timeStr.split(":").map(Number);
    const dt = new Date(base);
    dt.setHours(h ?? 0, m ?? 0, 0, 0);
    if (dt <= base) dt.setDate(dt.getDate() + 1);
    return dt;
  }

  function saveTasks() {
    localStorage.setItem("tasks", JSON.stringify(tasks));
  }

  function addTask() {
    const name = document.getElementById("taskInput").value.trim();
    const startStr = document.getElementById("startTime").value;
    const endStr = document.getElementById("endTime").value;

    if (!name || !startStr || !endStr) {
      alert("Please enter task, start time, and end time.");
      return;
    }

    let startDT = nextOccurrence(startStr);
    let endDT = nextOccurrence(endStr);
    while (endDT <= startDT) endDT.setDate(endDT.getDate() + 1);

    const durationMs = endDT - startDT;
    const durationText = fmtDuration(durationMs);

    tasks.push({
      id: crypto.randomUUID(),
      text: name,
      completed: false,
      startISO: startDT.toISOString(),
      endISO: endDT.toISOString(),
      durationText
    });

    saveTasks(); // ðŸ”’ persist to localStorage

    document.getElementById("taskInput").value = "";
    document.getElementById("startTime").value = "";
    document.getElementById("endTime").value = "";

    renderTasks();
    updateProgress();
    updateTimers();
  }

  function fmtTime(dt) {
    return dt.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
  }
  function fmtDate(dt) {
    return dt.toLocaleDateString([], { month: "short", day: "2-digit" });
  }
  function fmtDuration(ms) {
    const totalSec = Math.max(0, Math.floor(ms / 1000));
    const h = Math.floor(totalSec / 3600);
    const m = Math.floor((totalSec % 3600) / 60);
    return `${h}h ${m}m`;
  }

  function toggleTask(id) {
    const t = tasks.find(x => x.id === id);
    if (!t) return;
    t.completed = !t.completed;
    saveTasks(); // ðŸ”’ persist change
    renderTasks();
    updateProgress();
    updateTimers();
  }

  function deleteTask(id) {
    tasks = tasks.filter(t => t.id !== id);
    saveTasks(); // ðŸ”’ persist change
    renderTasks();
    updateProgress();
    updateTimers();
  }

  function renderTasks() {
    const list = document.getElementById("taskList");
    list.innerHTML = "";
    const now = new Date();

    tasks.forEach((task) => {
      const startDT = new Date(task.startISO);
      const endDT = new Date(task.endISO);

      const li = document.createElement("li");
      if (task.completed) li.classList.add("completed");

      li.innerHTML = `
        <div class="task-main">
          <span class="task-title">${escapeHtml(task.text)}</span>
          <div class="task-actions">
            <input type="checkbox" ${task.completed ? "checked" : ""} aria-label="Complete task">
            <button class="delete-btn" aria-label="Delete task">âœ–</button>
          </div>
        </div>
        <div class="time-info">
          Start: ${fmtTime(startDT)} (${fmtDate(startDT)}) |
          End: ${fmtTime(endDT)} (${fmtDate(endDT)}) |
          Duration: ${task.durationText}
          <div id="timer-${task.id}" class="timer"></div>
        </div>
      `;

      li.querySelector('input[type="checkbox"]').addEventListener('change', () => toggleTask(task.id));
      li.querySelector('.delete-btn').addEventListener('click', () => deleteTask(task.id));
      list.appendChild(li);
    });
  }

  function updateTimers() {
    const now = new Date();
    tasks.forEach(task => {
      const el = document.getElementById(`timer-${task.id}`);
      if (!el) return;

      const start = new Date(task.startISO);
      const end = new Date(task.endISO);

      if (now < start) {
        const sec = Math.floor((start - now) / 1000);
        el.textContent = `Starts in: ${countdown(sec)}`;
        el.className = "timer starting";
      } else if (now >= start && now < end) {
        const sec = Math.floor((end - now) / 1000);
        el.textContent = `Time left: ${countdown(sec)}`;
        el.className = "timer running";
      } else {
        el.textContent = "Expired";
        el.className = "timer expired";
      }
    });
  }

  function countdown(totalSec) {
    const h = Math.floor(totalSec / 3600);
    const m = Math.floor((totalSec % 3600) / 60);
    const s = totalSec % 60;
    return `${h}h ${m}m ${s}s`;
  }

  function updateProgress() {
    const total = tasks.length || 0;
    const completed = tasks.filter(t => t.completed).length;
    const percent = total ? Math.round((completed / total) * 100) : 0;
    const circle = document.getElementById("progressCircle");
    circle.textContent = percent + "%";
    circle.style.background = `conic-gradient(var(--ok) ${percent * 3.6}deg, #ddd ${percent * 3.6}deg)`;
  }

  function escapeHtml(s) {
    return s.replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;");
  }

  // Initial render on page load
  renderTasks();
  updateProgress();
  updateTimers();

  // Tick timers every second
  setInterval(updateTimers, 1000);
</script>
